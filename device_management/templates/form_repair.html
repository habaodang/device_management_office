{% extends "base.html" %}

{% block title %}Quản lý Thiết Bị{% endblock %}
{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/form_repair.css') }}">
{% endblock %}
{% block content %}
<!-- Phần bảo trì thiết bị -->
<main>
    <div class="maintenance">
        <h2>Nhập thông tin bảo trì thiết bị</h2>

        <!-- Hiển thị thông tin thiết bị đang bảo trì -->
        <div class="device-info">
            <h3>Thông tin thiết bị</h3>
            <p><strong>Tên máy:</strong> {{ device.ten_thiet_bi}}</p>
            <p><strong>Mã:</strong> {{ device.ma_tb}}</p>
            <p><strong>Model:</strong> {{ device.model}}</p>
            <p><strong>Số hiệu:</strong> {{ device.so_hieu}}</p>
            <p><strong>Nước sản xuất:</strong> {{ device.nsx}}</p>
            <p><strong>Năm sản xuất:</strong> {{ device.nam_sx}}</p>
            <p><strong>Nguyên giá:</strong> {{ device.nguyen_gia}}</p>
            <p><strong>Hãng sản xuất:</strong> {{ device.hang_sx}}</p>
            <p><strong>Khoa:</strong> {{ device.khoa}}</p>
            <p><strong>Nguồn cấp:</strong> {{ device.nguon_cap}}</p>
            <p><strong>số lượng:</strong> {{ device.sl}}</p>
            <p><strong>Ngày lắp:</strong> {{ device.ngay_lap_cho_khoa}}</p>
            <p><strong>Ghi chú:</strong> {{ device.ghi_chu}}</p>
        </div>

        <!-- Hiển thị danh sách các bảo trì đã có -->
        <h3>Danh sách bảo trì đã thực hiện</h3>
        {% if device.maintenance_status %}
        <p>tắt trạng thái bảo trì cho thiết bị</p>
        <a href="{{ url_for('main.status_maintenance',stt=device.stt) }} ">
            <button id="btn_maintenance">Hoàn thành</button>
        </a>
        {% else %}
        <p>Bật trạng thái bảo trì cho thiết bị</p>
        <a href="{{ url_for('main.status_maintenance',stt=device.stt) }} ">
            <button id="btn_maintenance">Bảo trì</button>
        </a>
        {% endif %}


        <!-- Biểu mẫu nhập liệu cho bảo trì -->
        <form class="maintenance-form" method="POST" action="{{ url_for('main.add_bao_tri', thietbi_id=device.stt) }}">
            <table id="maintenance-table">
                <thead>
                <tr>
                    <th>Ngày tháng</th>
                    <th>Hiện tượng hư hỏng</th>
                    <th>Cách sửa chữa</th>
                    <th>Chuyên viên sửa chữa</th>
                    <th>Ghi chú</th>
                </tr>
                </thead>
                <tbody>
                {% if repairs %}

                {% for repair in repairs %}
                <tr>
                    <!-- Hiển thị thông tin bảo trì cũ mà không có ô input -->
                    <td>{{ repair.ngay_thang }}</td>
                    <td>{{ repair.hien_tuong_hu_hong }}</td>
                    <td>{{ repair.cach_sua_chua }}</td>
                    <td>{{ repair.chuyen_vien_sua_chua }}</td>
                    <td>{{ repair.ghi_chu }}</td>
                </tr>
                {% endfor %}
                {% endif %}
                <tr>
                    <!-- Chỉ gửi bảo trì mới -->
                    <input type="hidden" name="stt" value="{{ device.stt }}">
                    <td><input type="date" name="ngay_thang" required></td>
                    <td><textarea name="hien_tuong_hu_hong" placeholder="Mô tả hiện tượng hư hỏng" required></textarea>
                    </td>
                    <td><textarea name="cach_sua_chua" placeholder="Mô tả cách sửa chữa" required></textarea></td>
                    <td><input type="text" name="chuyen_vien_sua_chua" placeholder="Tên chuyên viên" required></td>
                    <td><textarea name="ghi_chu" placeholder="Ghi chú thêm"></textarea></td>
                </tr>
                </tbody>
            </table>

            <!-- Nút thêm bảo trì mới -->
            <button type="submit" class="btn-submit">Lưu thông tin bảo trì</button>
            <a href="{{ url_for('main.export_excel',stt = device.stt) }}">
                <button type="button" id="btn_ex">Xuất Excel</button>
            </a>
        </form>
    </div>
</main>

{% endblock %}